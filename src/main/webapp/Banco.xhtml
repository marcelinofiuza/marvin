<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core" xmlns:ui="http://xmlns.jcp.org/jsf/facelets" xmlns:p="http://primefaces.org/ui"
	template="/WEB-INF/templates/Layout.xhtml">

	<ui:define name="content">
		<section class="r42-pagina">

			<!-- execução inicial -->
			<f:metadata>
				<f:viewAction action="#{controleBanco.listar}" />
			</f:metadata>

			<h:form id="frm">
				<!-- Mensagem form -->
				<p:growl id="msg-frm" showDetail="true" />

				<!-- Barra Ferramentas -->
				<p:toolbar styleClass="r42-toolbar" id="toolbar">
					<p:toolbarGroup align="left">
						<p:commandButton    id="bto-novo" 
											title="Novo" 
											icon="fa fa-file-o" 
											actionListener="#{controleBanco.novoCadastro}"
											process="@this" 
											update="dialogo" 
											oncomplete="PF('wgDados').show()">
											<p:resetInput target="dialogo" />
						</p:commandButton>
						<p:commandButton    id="bto-editar" 
						                    title="Editar" 
						                    icon="fa fa-pencil" 
						                    process="@this" 
						                    update="dialogo"
							                oncomplete="PF('wgDados').show()" 
							                disabled="#{controleBanco.bancoSelect == null}"
							                actionListener="#{controleBanco.editCadastro}">
							                <p:resetInput target="dialogo" />
						</p:commandButton>
						<p:commandButton    id="bto-excluir" 
						                    title="Excluir" 
						                    icon="fa fa-trash" 
						                    process="@this"
							                disabled="#{controleBanco.bancoSelect == null}" 
							                update="tabela msg-frm toolbar"
							                actionListener="#{controleBanco.excluir}">
							                <p:confirm icon="fa fa-warning" header="Exclusão de Registro" message="Confirma a exclusão do Banco?" />
						</p:commandButton>
                        <span class="ui-separator">
                            <span class="fa fa-fw fa-ellipsis-v"/>
                        </span>
                        <p:commandButton    id="bto-periodo" 
                                            title="Periodo Movimentação" 
                                            icon="fa fa-calendar" 
                                            process="@this" 
                                            update="dialogo"
                                            oncomplete="PF('wgPeriodo').show()" 
                                            disabled="#{controleBanco.bancoSelect == null}"
                                            actionListener="#{controleBanco.editPeriodo}">
                        </p:commandButton>                       						
					</p:toolbarGroup>

					<p:toolbarGroup align="right" styleClass="r42-toolbar-right">
						<p>Bancos</p>
					</p:toolbarGroup>
				</p:toolbar>

				<!-- Listagem dos dados -->
				<p:dataTable value="#{controleBanco.listaBancos}" 
				             var="banco" 
				             id="tabela" 
				             reflow="true" 
				             rows="15" paginator="true"
					         paginatorPosition="top" 
					         selection="#{controleBanco.bancoSelect}" 
					         selectionMode="single" rowKey="#{banco.idBanco}"
					         emptyMessage="Nenhum Banco Cadastrado">

					<!-- Evento ajax, que atuliza a barra de ferramentas, quando marca/desmarca uma linha -->
					<p:ajax event="rowSelect" update=":frm:toolbar" />
					<p:ajax event="rowUnselect" update=":frm:toolbar" />

					<!-- Colunas -->
					<p:column headerText="Id" width="50">
						<h:outputText value="#{banco.idBanco}" />
					</p:column>
					<p:column headerText="Descrilção">
						<h:outputText value="#{banco.descricao}" />
					</p:column>
					<p:column headerText="Agência" width="100">
						<h:outputText value="#{banco.agencia}" />
					</p:column>
					<p:column headerText="Nome" width="300">
						<h:outputText value="#{banco.nomeAgencia}" />
					</p:column>
					<p:column headerText="N° Conta" width="100">
						<h:outputText value="#{banco.numeroConta}" />
					</p:column>

				</p:dataTable>

				<!-- Dialogo inclusão/alteração -->
				<p:dialog styleClass="r42-dialogo" 
				          header="Dados Banco" 
				          widgetVar="wgDados" 
				          id="dialogo" 
				          modal="true" 
				          resizable="false"
					      responsive="true">

					<!-- Barra de Ferramentas dialogo-->
					<p:defaultCommand target="bto-salvar" scope="dialogo" />
					<p:toolbar>
						<p:toolbarGroup align="left">
							<p:commandButton id="bto-salvar" 
							                 title="Salvar" 
							                 icon="fa fa-save" 
							                 action="#{controleBanco.salvar}" 
							                 process="dialogo"
								             update="panel-dados" 
								             oncomplete="if(!args.validationFailed) PF('wgDados').hide()" />
						</p:toolbarGroup>
					</p:toolbar>

					<p:messages id="messages" showDetail="false" autoUpdate="true" closable="true" />

					<!-- Dados Dialogo -->
					<p:tabView id="panel-dados">

						<!-- Aba Dados Banco -->
						<p:tab title="Dados Banco">
							<p:panelGrid columns="2" 
							             layout="grid" 
							             styleClass="panelgrid-noborder r42-panelgrid"
								         columnClasses="ui-grid-col-3, ui-grid-col-9">

								<p:outputLabel value="Febraban" for="febraban" />
								<p:selectOneMenu id="febraban" value="#{controleBanco.bancoEdicao.febraban}">
									<f:selectItem itemLabel="Selecione" />
									<f:selectItems value="#{controleBanco.febraban}" 
									               var="febraban" 
									               itemLabel="#{febraban.nome}" 
									               itemValue="#{febraban}" />
								</p:selectOneMenu>

								<p:outputLabel value="Descrição" for="descricao" />
								<p:inputText id="descricao" size="50" maxlength="50" 
								             value="#{controleBanco.bancoEdicao.descricao}"
									         onblur="value=value.toUpperCase()" />

								<p:outputLabel value="Agência" for="agencia" />
								<p:inputText id="agencia" size="10" maxlength="15" 
								             value="#{controleBanco.bancoEdicao.agencia}"
									         onblur="value=value.toUpperCase()" />

								<p:outputLabel value="Nome Agência" for="nomeAgencia" />
								<p:inputText id="nomeAgencia" size="30" maxlength="30" 
								             value="#{controleBanco.bancoEdicao.nomeAgencia}"
									         onblur="value=value.toUpperCase()" />

								<p:outputLabel value="N° Conta" for="numeroConta" />
								<p:inputText id="numeroConta" size="15" maxlength="15" 
								             value="#{controleBanco.bancoEdicao.numeroConta}"
									         onblur="value=value.toUpperCase()" />

                                <p:outputLabel value="Conta Contábil" for="conta" />                                
                                <p:column>                                
	                                <p:inputText id="conta" size="10"
	                                             value="#{controleBanco.conta.idConta}"
	                                             readonly="true"/>

                                    <p:commandButton icon="fa fa-search" 
                                                     title="Pesquisar"
                                                     action="#{pesquisaConta.abrirDialogo}"
                                                     process="@this"
                                                     update="@none">
                                                 
                                        <p:ajax event="dialogReturn" 
                                                listener="#{controleBanco.contaSelecionada}"
                                                process="@this"                                             
                                                update="conta contaDescricao"/>
                                            
                                    </p:commandButton>
                                    <p:spacer width="10"/>                                                                         
                                    <p:inputText id="contaDescricao" size="50"
                                                 value="#{controleBanco.conta.descricao}"
                                                 readonly="true"/>
                                
                                </p:column>
							</p:panelGrid>
						</p:tab>

						<!-- Aba Endereço -->
						<p:tab title="Endereço">

							<p:panelGrid columns="2" 
							             layout="grid" 
							             styleClass="panelgrid-noborder r42-panelgrid"
								         columnClasses="ui-grid-col-3, ui-grid-col-9">

								<p:outputLabel value="CEP" for="cep" />
								<p:inputMask id="cep" size="10" maxlength="9" 
								             value="#{controleBanco.bancoEdicao.endereco.cep}" 
								             mask="99999-999" />

								<p:outputLabel value="Tipo Logradouro" for="tipo-logradouro" />
								<p:inputText id="tipo-logradouro" size="15" maxlength="15"
									         value="#{controleBanco.bancoEdicao.endereco.tipoLogradouro}" 
									         onblur="value=value.toUpperCase()" />

								<p:outputLabel value="Logradouro" for="logradouro" />
								<p:inputText id="logradouro" size="50" maxlength="50" 
								             value="#{controleBanco.bancoEdicao.endereco.logradouro}"
									         onblur="value=value.toUpperCase()" />

								<p:outputLabel value="Número" for="numero" />
								<p:inputText id="numero" size="10" maxlength="10" value="#{controleBanco.bancoEdicao.endereco.numero}"
									onblur="value=value.toUpperCase()" />

								<p:outputLabel value="Complemento" for="complemento" />
								<p:inputText id="complemento" size="20" maxlength="20" 
								             value="#{controleBanco.bancoEdicao.endereco.complemento}"
									         onblur="value=value.toUpperCase()" />

								<p:outputLabel value="Bairro" for="bairro" />
								<p:inputText id="bairro" size="40" maxlength="40" 
								             value="#{controleBanco.bancoEdicao.endereco.bairro}"
									         onblur="value=value.toUpperCase()" />

								<p:outputLabel value="Cidade" for="cidade" />
								<p:inputText id="cidade" size="40" maxlength="40" 
								             value="#{controleBanco.bancoEdicao.endereco.cidade}"
									         onblur="value=value.toUpperCase()" />

								<p:outputLabel value="Estado" for="uf" />
								<p:selectOneMenu id="uf" value="#{controleBanco.bancoEdicao.endereco.uf}">
									<f:selectItem itemLabel="Selecione" />
									<f:selectItems value="#{controleBanco.estados}" 
									               var="estado" 
									               itemLabel="#{estado.nome}" 
									               itemValue="#{estado}" />
								</p:selectOneMenu>

							</p:panelGrid>
						</p:tab>

						<!-- Aba Contatos -->
						<p:tab title="Contatos">

							<p:panelGrid id="panelContato" 
							             columns="2" 
							             layout="grid" 
							             styleClass="panelgrid-noborder r42-panelgrid"
								         columnClasses="ui-grid-col-3, ui-grid-col-9">

								<p:outputLabel value="Nome" for="nome" />
								<p:inputText id="nome" size="50" maxlength="50" 
								             value="#{controleBanco.bancoContatos.contato.nomeContato}"
									         onblur="value=value.toUpperCase()" />

								<p:outputLabel value="E-mail" for="email" />
								<p:inputText id="email" size="50" maxlength="50" 
								             value="#{controleBanco.bancoContatos.contato.email}"
									         onblur="value=value.toLowerCase()" />

								<p:outputLabel value="Telefone" for="telefone" />
								<p:inputMask id="telefone" size="15" maxlength="15" 
								             value="#{controleBanco.bancoContatos.contato.telefone}"
									         mask="(99)-9999-9999" />

								<p:outputLabel value="Ramal" for="ramal" />
								<p:inputText id="ramal" size="5" maxlength="5" 
								             value="#{controleBanco.bancoContatos.contato.ramal}"
									         onblur="value=value.toUpperCase()" />

								<p:outputLabel value="Celular" for="celular" />
								<p:inputMask id="celular" size="15" maxlength="15" 
								             value="#{controleBanco.bancoContatos.contato.celular}"
									         mask="(99)-99999-9999" />

								<p:commandButton id="bto-add" 
								                 title="Atualizar lista" 
								                 icon="fa fa-arrow-down" 
								                 value="Atualizar"
									             action="#{controleBanco.addContato}" 
									             process="panelContato" 
									             update="panelContato tabContatos" />

							</p:panelGrid>

							<!-- Listagem dos dados -->
							<p:dataTable value="#{controleBanco.listaBancoContatos}" 
							             var="c" 
							             id="tabContatos" 
							             reflow="true" 
							             rows="3"
								         paginator="true" 
								         paginatorPosition="top" 
								         selection="#{controleBanco.bancoContatos}" 
								         selectionMode="single"
								         rowKey="#{c.idContato}" 
								         emptyMessage="Nenhum Contato Cadastrado">

								<!-- Evento ajax, para doubleClick na lista de contatos -->
								<p:ajax event="rowSelect" update="frm:panel-dados:panelContato frm:panel-dados:tabContatos" />
								<p:ajax event="rowUnselect" update="frm:panel-dados:panelContato frm:panel-dados:tabContatos"
									    listener="#{controleBanco.limpaContato}" />

								<!-- Colunas -->
								<p:column headerText="Nome" width="200">
									<h:outputText value="#{c.contato.nomeContato}" />
								</p:column>
								<p:column headerText="E-mail">
									<h:outputText value="#{c.contato.email}" />
								</p:column>
								<p:column headerText="Telefone" width="130">
									<h:outputText value="#{c.contato.telefone}" />
								</p:column>
								<p:column headerText="Ramal" width="50">
									<h:outputText value="#{c.contato.ramal}" />
								</p:column>
								<p:column headerText="Celular" width="130">
									<h:outputText value="#{c.contato.celular}" />
								</p:column>
								<p:column headerText="#" width="35">
									<p:commandButton icon="fa fa-trash" 
									                 title="Remover" 
									                 action="#{controleBanco.removeContato(c)}" 
									                 process="@this"
										             update="frm:panel-dados:panelContato frm:panel-dados:tabContatos" />
								</p:column>

							</p:dataTable>
						</p:tab>
					</p:tabView>
				</p:dialog>
				
				<!-- Dialogo Periodo de Movimentação -->
                <p:dialog styleClass="r42-dialogo" 
                          header="Dados Periodo" 
                          widgetVar="wgPeriodo" 
                          id="dialogoPeriodo" 
                          modal="true" 
                          resizable="false"
                          responsive="true">
                                                    
                    <!-- Barra de Ferramentas dialogo-->
                    <p:defaultCommand target="btoPer-novo" scope="dialogo" />
                    <p:toolbar>
                        <p:toolbarGroup align="left">
	                        <p:commandButton    id="btoPer-novo" 
	                                            title="Novo" 
	                                            icon="fa fa-file-o" 
	                                            actionListener="#{controleBanco.novoPeriodo}"
	                                            process="@this" 
	                                            update="dialogoDadosPeriodo" 
	                                            oncomplete="PF('wgDadosPeriodo').show()">
	                                            <p:resetInput target="dialogoDadosPeriodo" />
	                        </p:commandButton>
	                   </p:toolbarGroup>
                    </p:toolbar>
                                                                        
                    <p:messages id="msgPeriodo" showDetail="false" autoUpdate="true" closable="true" />
                           
                    <!-- Listagem dos dados -->
                    <p:dataTable value="#{controleBanco.listaBancoSaldo}" 
                                 var="saldo" 
                                 id="tabSaldo" 
                                 reflow="true" 
                                 rows="12"
                                 paginator="true" 
                                 paginatorPosition="top"  
                                 emptyMessage="Nenhum Periodo Existente">
                                 
	                    <!-- Colunas -->
	                    <p:column headerText="Data Inicial" width="50">
	                        <h:outputText value="#{saldo.dataInicio}">
                                <f:convertDateTime type="date" pattern="dd/MM/yyyy"/>                                
	                        </h:outputText>
	                    </p:column>                                 
	                    <p:column headerText="Data Final" width="50">
	                        <h:outputText value="#{saldo.dataFinal}">
                                <f:convertDateTime type="date" pattern="dd/MM/yyyy"/>
	                        </h:outputText>
	                    </p:column>                      
	                    <p:column headerText="Saldo Inicial" width="50">
	                        <h:outputText value="#{saldo.saldoInicial}">
                                <f:convertNumber type="currency" />
	                        </h:outputText>	                        
	                    </p:column> 
	                    <p:column headerText="Débito" width="50">
	                        <h:outputText value="#{saldo.debito}">
                                <f:convertNumber type="currency" />
	                        </h:outputText>
	                    </p:column> 
	                    <p:column headerText="Crédito" width="50">
	                        <h:outputText value="#{saldo.credito}">
                                <f:convertNumber type="currency" />	                        
	                        </h:outputText>
	                    </p:column> 
	                    <p:column headerText="Saldo Final" width="50">
                            <h:outputText value="#{saldo.saldoFinal}">
                                <f:convertNumber type="currency" />                         
                            </h:outputText>                            
	                    </p:column> 
	                    <p:column headerText="Fechado" width="50">
	                        <p:selectBooleanCheckbox value="#{saldo.fechado}" disabled="true" />
	                    </p:column>
                                                                                                                                     
                    </p:dataTable>
                </p:dialog>
                
                <!-- Dialogo Periodo de Movimentação -->
                <p:dialog styleClass="r42-dialogo2" 
                          header="Periodo" 
                          widgetVar="wgDadosPeriodo" 
                          id="dialogoDadosPeriodo" 
                          modal="true" 
                          resizable="false"
                          responsive="true">
                          
                    <p:panelGrid id="panelPeriodo" 
                                 columns="2" 
                                 layout="grid" 
                                 styleClass="panelgrid-noborder r42-panelgrid"
                                 columnClasses="ui-grid-col-3, ui-grid-col-9">

                        <p:outputLabel value="Data Inicial" for="dataInicial" />
                        <p:calendar id="dataInicial" size="10"
                                    locale="pt_BR"
                                    value="#{controleBanco.saldoEdicao.dataInicio}"
                                    pattern="dd/MM/yyyy" mask="99/99/9999"
                                    showOn="button"/>
                                                                    
                    </p:panelGrid>  
                </p:dialog>                
			</h:form>
		</section>
	</ui:define>
</ui:composition>